# Sample Diagnostic Bundle (`diag-<uuid>.zip`)

This document describes the contents of a sample diagnostic bundle generated by the `DiagnosticsAgent`. The bundle is a zip file containing logs and metadata to help debug issues with `redlib` updates or runs.

## Bundle Structure

```
diag-a1b2c3d4/
├── manifest.json
├── update-logs/
│   └── update-e5f6g7h8.log
├── run-logs/
│   └── run-i9j0k1l2.log
├── device-info.txt
└── binary-metadata.txt
```

---

### 1. `manifest.json`

A JSON file containing metadata about the bundle itself.

```json
{
  "bundleId": "diag-a1b2c3d4",
  "createdAt": "2025-09-19T10:00:00Z",
  "context": "install",
  "targetId": "update-e5f6g7h8",
  "scrubbed": true,
  "appVersion": "1.0.0"
}
```

---

### 2. Update Logs (`update-logs/`)

Contains logs from the `UpdateAgent` for the relevant update attempt.

**Example: `update-e5f6g7h8.log`**

```
[2025-09-19T09:55:01Z] UpdateStarted: id=e5f6g7h8, url=http://example.com/redlib-v2.tar.gz
[2025-09-19T09:55:02Z] UpdateProgress: phase=fetch, bytes=1024, total=1024
[2025-09-19T09:55:03Z] UpdateProgress: phase=extract
[2025-09-19T09:55:04Z] UpdateProgress: phase=sanity
[2025-09-19T09:55:04Z] UpdateFailed: reason=sanity_failed, error=Binary failed to execute: exit code 126
```

---

### 3. Run Logs (`run-logs/`)

Contains stdout/stderr from the `RunAgent` for the relevant run attempt.

**Example: `run-i9j0k1l2.log`**

```
[stdout] Starting server...
[stderr] Warning: a config value is deprecated.
...
```

---

### 4. `device-info.txt`

A plain text file with key-value pairs describing the device environment.

```
Android SDK=34
ABI=arm64-v8a
SELinux Mode=Enforcing
Available RAM (MB)=4096
Disk Free (MB)=8192
Network=WIFI
```

---

### 5. `binary-metadata.txt`

Information about the `redlib` binary that was being installed or run.

```
Path=/files/redlib/tmp/update-e5f6g7h8/redlib
Size=1234567
Mode=-rwxr-xr-x (755)
Last Modified=2025-09-19T09:55:03Z

--- readelf -l output ---
...
(output of readelf on the binary)
...
```
